\documentclass[a5paper,9pt]{book}     % 
\usepackage[utf8]{inputenc}            % for input encoding
\usepackage{amsmath,amsfonts,amssymb}  % for mathematical symbols and fonts
\usepackage{tcolorbox}
\usepackage{caption}    % Package for better captions
\usepackage{eso-pic}     % Allows adding elements to the page background
\usepackage{graphicx}    % For including images
\usepackage{afterpage}   % To control background images after specific pages

\usepackage{listings}
\lstset{
    language=Python,        % Set language to Python
    showstringspaces=false  % Prevent spaces from being printed as visible characters
}

\usepackage[a5paper, margin=0cm]{geometry} % for page layout
\usepackage{natbib}                    % for bibliography management
\usepackage{setspace}                  % for controlling line spacing
\usepackage{xcolor}
\usepackage{fancyhdr}  % For custom headers and footers
\usepackage{microtype}       % Improves justification and spacing

\usepackage[colorlinks=false, linktoc=all]{hyperref}
\usepackage{footnotebackref}
\usepackage[hang, flushmargin]{footmisc}
\usepackage[english]{babel}

\pagestyle{fancy}      % Set the page style to fancy
\fancyhf{}             % Clear all header and footer fields
\fancyhead[LE,RO]{\thepage} % Page numbers on the outer side
\fancyhead[LO,RE]{\nouppercase{\leftmark}} % Chapter titles in headers

% Define colors
\definecolor{comment}{rgb}{0.0, 0.5, 0.0} % A darker green
\definecolor{white}{rgb}{1.0, 1.0, 1.0}

\geometry{
    a5paper,         % Set the paper size to A5
    inner=15mm,      % Inner margin for binding (reduced from 25mm)
    outer=12mm,      % Outer margin (reduced from 20mm)
    top=15mm,        % Top margin (reduced from 25mm)
    bottom=12mm,     % Bottom margin (reduced from 20mm)
    headsep=7mm,     % Space between header and text (proportional to A5)
    footskip=7mm,    % Space between footer and text (proportional to A5)
    includehead,     % Include header in margin calculations
    includefoot,     % Include footer in margin calculations
}

% Command to set the background image for a single page
\newcommand\BackgroundPicFrontPage{
  \AddToShipoutPictureBG*{
    \AtPageLowerLeft{
      \includegraphics[width=\paperwidth,height=\paperheight]{assets/background-frontpage.png}
    }
  }
}

% Switch to monospace font globally
\renewcommand{\familydefault}{\ttdefault}

% \doublespacing  % Use 1.5 line spacing
\setcounter{secnumdepth}{3}            % number sub-subsections
\setcounter{tocdepth}{0}               % depth of table of contents


% Prevent overflow issues
\setlength{\emergencystretch}{3em} % Allow slight stretching of lines
\sloppy                      % Loosen word spacing rules slightly
\widowpenalty=10000          % Avoid widow lines (single lines at the top of a page)
\clubpenalty=10000           % Avoid club lines (single lines at the bottom of a page)
\brokenpenalty=10000         % Avoid page breaks inside paragraphs
\raggedbottom                % Avoid stretching the page vertically

\begin{document}

% Set the front page background image
\BackgroundPicFrontPage

\title{\textbf{There is a closed door at the end of the corridor}}
\author{\textbf{Mauricio van der Maesen de Sombreff}}
\date{\the\year}

\maketitle     % generate the title page

% Reset color after front page
\ClearShipoutPicture
\color{black}

% \clearpage  % Move to the next page (to avoid background on TOC)
\pagestyle{empty}  % No page number on the TOC
{
    \newgeometry{
        a5paper,         % Set the paper size to A5
        inner=15mm,      % Inner margin for binding (reduced from 25mm)
        outer=12mm,      % Outer margin (reduced from 20mm)
        top=2mm,        % Top margin (reduced from 25mm)
        bottom=12mm,     % Bottom margin (reduced from 20mm)
        headsep=2mm,     % Space between header and text (proportional to A5)
        footskip=7mm,    % Space between footer and text (proportional to A5)
        includehead,     % Include header in margin calculations
        includefoot,     % Include footer in margin calculations
    }  
    \small 
    \tableofcontents
    \normalsize
    \clearpage % Ensure new page for subsequent content
    \restoregeometry % Restore original margins
}

% \pagestyle{empty}  % No page number on the TOC

\newpage  % Move to the next page after TOC
\pagestyle{plain}  % Start page numbering again

\include{preface}
\include{introduction}
\include{memory}
\include{curiosity}
\include{neurodiversity}
\include{perception}
\include{laplace-demon}
\include{hypervigilance}
\include{wave-function-collapse}
\include{emulation}
\include{decay}
\include{readings}

\end{document}
